
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŸï¸ USJé–€ç¥¨é–‹è³£æŸ¥è©¢å°å·¥å…·</title>
  <style>
    body {
      font-family: 'Arial', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
      background: linear-gradient(to bottom, #ffe6f0, #fff);
      color: #cc3366;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      background-color: #ffb6c1;
      padding: 2rem 1rem;
      border-bottom-left-radius: 30px;
      border-bottom-right-radius: 30px;
    }
    header h1 {
      font-size: 2rem;
      margin: 0;
      color: #fff;
      text-shadow: 1px 1px #d63384;
    }
    header p {
      margin-top: 0.5rem;
      font-size: 1.2rem;
      color: #fff;
    }
    main {
      padding: 2rem 1rem;
    }
    input, button, a.tool-btn {
      font-size: 1.2rem;
      padding: 0.7rem;
      margin-top: 0.7rem;
      width: 90%;
      max-width: 400px;
      border: none;
      border-radius: 10px;
      box-sizing: border-box;
      text-align: center;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    input {
      border: 2px solid #ffb6c1;
      background-color: #fff;
    }
    button, a.tool-btn {
      background-color: #ff85a2;
      color: white;
      cursor: pointer;
      transition: transform 0.2s, background-color 0.2s;
    }
    button:hover, a.tool-btn:hover {
      transform: scale(1.05);
      background-color: #e76f8f;
    }
    .btn-calendar {
      background-color: #ffc2d1;
      color: #d63384;
      margin-top: 1rem;
    }
    #result, #daysLeft, #countdown, #calendarLinks, #helpLinks {
      display: none;
      margin-top: 1rem;
    }
    footer {
      margin-top: 3rem;
      padding: 1rem;
      font-size: 0.9rem;
      color: #aaa;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ¢ USJé–€ç¥¨é–‹è³£å°å·¥å…· ğŸŸï¸</h1>
    <p>ç²‰ç´…å‡ç´šç‰ˆãƒ»å¿«é€ŸæŸ¥è©¢ãƒ»ä¸€éµè¨­æé†’</p>
  </header>

  <main>
    <p>è«‹è¼¸å…¥å…¥åœ’æ—¥æœŸï¼ˆæ ¼å¼ï¼šMMDDï¼Œä¾‹å¦‚0822ï¼‰</p>
    <input type="text" id="dateInput" placeholder="ä¾‹å¦‚ï¼š0822" maxlength="4" inputmode="numeric">
    <button onclick="calculateSaleDate()">æŸ¥è©¢é–‹è³£æ™‚é–“</button>

    <div id="result"></div>
    <div id="daysLeft"></div>
    <div id="countdown"></div>
    <div id="calendarLinks" style="margin-top:1.5rem;"></div>

    <div id="helpLinks" style="margin-top: 2rem;">
      <a class="tool-btn btn-calendar" href="https://vocus.cc/wo/67b3d439fd8978000122bb24" target="_blank">
        ğŸ“˜ å®˜ç¶²è³¼ç¥¨æ•™å­¸
      </a><br>
      <p style="margin-top: 1rem; font-size: 1.1rem; font-weight: bold; color: #d63384;">ä»£è¨‚ / åˆ·å¡å¤±æ•—ä»£ä»˜</p>
      <a href="https://lin.ee/wLFxlop" target="_blank" style="display:inline-block;margin-top:0.5rem;">
        <img src="https://scdn.line-apps.com/n/line_add_friends/btn/zh-Hant.png" alt="ä»£è¨‚/åˆ·å¡ä»£ä»˜" height="50" style="border:0;">
      </a>
    </div>
  </main>

  <footer>
    Â© 2025 USJå°åŠ©æ‰‹ãƒ»è¨­è¨ˆ by TT ğŸ€
  </footer>

<script>
function isLeapYear(year) {
  return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
}

function findNextLeapYear(fromYear) {
  let year = fromYear + 1;
  while (!isLeapYear(year)) {
    year++;
  }
  return year;
}

function calculateSaleDate() {
  const inputField = document.getElementById('dateInput');
  let input = inputField.value.trim();
  const result = document.getElementById('result');
  const daysLeft = document.getElementById('daysLeft');
  const calendarLinks = document.getElementById('calendarLinks');
  const countdown = document.getElementById('countdown');
  const helpLinks = document.getElementById('helpLinks');

  input = input.replace(/\D/g, '');

  if (!/^\d{4}$/.test(input)) {
    result.innerText = 'è«‹è¼¸å…¥4ä½æ•¸å­—ï¼ˆä¾‹å¦‚0822ï¼‰';
    result.style.display = 'block';
    daysLeft.style.display = 'none';
    countdown.style.display = 'none';
    calendarLinks.style.display = 'none';
    helpLinks.style.display = 'none';
    return;
  }

  let month = parseInt(input.substring(0, 2), 10);
  let day = parseInt(input.substring(2, 4), 10);
  let year = new Date().getFullYear();

  let visitDate = new Date(year, month - 1, day);
  if (month === 2 && day === 29 && !isLeapYear(year)) {
    year = findNextLeapYear(year);
    visitDate = new Date(year, 1, 29);
  }

  if (visitDate.getMonth() + 1 !== month || visitDate.getDate() !== day) {
    result.innerText = 'è¼¸å…¥çš„æ—¥æœŸä¸å­˜åœ¨ï¼Œè«‹ç¢ºèªæœˆä»½èˆ‡å¤©æ•¸';
    result.style.display = 'block';
    daysLeft.style.display = 'none';
    countdown.style.display = 'none';
    calendarLinks.style.display = 'none';
    helpLinks.style.display = 'none';
    return;
  }

  const today = new Date();
  const todayDateOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
  if (visitDate < today) {
    visitDate.setFullYear(today.getFullYear() + 1);
  }

  const saleDate = new Date(visitDate.getTime() - 94 * 24 * 60 * 60 * 1000);
  saleDate.setHours(23, 0, 0, 0);

  result.innerText = `ğŸŸï¸ é–‹è³£æ™‚é–“ï¼š${saleDate.toLocaleDateString('zh-TW')} æ™šä¸Š23:00ï¼ˆå°ç£æ™‚é–“ï¼‰`;
  result.style.display = 'block';
  helpLinks.style.display = 'block';

  const diffTime = saleDate.getTime() - todayDateOnly.getTime();
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

  if (diffDays > 0) {
    createCalendarLinks(saleDate);
    startCountdownTo2300();
    updateDaysLeft(saleDate);
  } else {
    calendarLinks.style.display = 'none';
    countdown.style.display = 'none';
    daysLeft.innerText = `ğŸ“… å·²ç¶“é–‹è³£å›‰ï¼`;
    daysLeft.style.display = 'block';
  }
}

function createCalendarLinks(saleDate) {
  const calendarLinks = document.getElementById('calendarLinks');
  calendarLinks.innerHTML = "";

  const yyyy = saleDate.getFullYear();
  const mm = String(saleDate.getMonth() + 1).padStart(2, '0');
  const dd = String(saleDate.getDate()).padStart(2, '0');
  const utcHour = 15; // å°ç£23:00å°æ‡‰UTC15:00

  const startDateTime = `${yyyy}${mm}${dd}T${utcHour}0000Z`;
  const endDateTime = `${yyyy}${mm}${dd}T${utcHour + 1}0000Z`;

  const googleCalUrl = `https://www.google.com/calendar/render?action=TEMPLATE&text=USJ+é–€ç¥¨é–‹è³£&dates=${startDateTime}/${endDateTime}&details=è¨˜å¾—æ¶ç¥¨ï¼&location=å°ç£&trp=true`;

  const icsContent =
`BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:USJé–€ç¥¨é–‹è³£æé†’
DESCRIPTION:è¨˜å¾—æ¶ç¥¨ï¼
DTSTART:${startDateTime}
DTEND:${endDateTime}
LOCATION:å°ç£
BEGIN:VALARM
TRIGGER:-PT5M
ACTION:DISPLAY
DESCRIPTION:USJé–€ç¥¨å³å°‡é–‹è³£
END:VALARM
END:VEVENT
END:VCALENDAR`;

  const blob = new Blob([icsContent], { type: 'text/calendar' });
  const icsUrl = URL.createObjectURL(blob);

  const shareLineUrl = `https://line.me/R/msg/text/?USJé–€ç¥¨å³å°‡é–‹è³£ï¼è¨˜å¾—è¨­å¥½é¬§é˜æ¶ç¥¨ï½`;

  calendarLinks.innerHTML += `<a class="tool-btn btn-calendar" href="${googleCalUrl}" target="_blank">â• åŠ åˆ° Google æ—¥æ›†</a><br>`;
  calendarLinks.innerHTML += `<a class="tool-btn btn-calendar" href="${icsUrl}" download="USJ_ticket_sale_reminder.ics">â• åŠ åˆ° iPhone æ—¥æ›†</a><br>`;
  calendarLinks.style.display = 'block';
}

function startCountdownTo2300() {
  const countdown = document.getElementById('countdown');
  countdown.style.display = 'block';

  function updateCountdown() {
    const now = new Date();
    let target = new Date(now);
    target.setHours(23, 0, 0, 0);
    if (now > target) target.setDate(target.getDate() + 1);

    const diff = target - now;
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

    countdown.innerText = `â³ è·é›¢ä»Šæ™š 23:00 é‚„æœ‰ ${hours} å°æ™‚ ${minutes} åˆ† ${seconds} ç§’`;
  }
  updateCountdown();
  setInterval(updateCountdown, 1000);
}

function updateDaysLeft(saleDate) {
  const daysLeft = document.getElementById('daysLeft');
  daysLeft.style.display = 'block';

  const today = new Date();
  const diffTime = saleDate.getTime() - today.getTime();
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

  daysLeft.innerText = (diffDays > 0) ? `ğŸ“… é›¢é–‹è³£é‚„æœ‰ ${diffDays} å¤©` :
                     (diffDays === 0) ? `ğŸ“… ä»Šå¤©å°±æ˜¯é–‹è³£æ—¥ï¼` :
                     `ğŸ“… å·²ç¶“é–‹è³£å›‰ï¼`;
}
</script>
</body>
</html>
